<h1>Message <small>'{{subject}}'</small></h1>

{{#if errors.firstObject}}
  <div class="alert alert-danger" role="alert">{{join-errors errors}}</div>
{{/if}}

<form class="form-horizontal" role="form" {{action 'save' on="submit"}}>
  <fieldset>
    <div class="form-group" >
      <label class="col-lg-1 control-label">From</label>
      <div class="col-lg-5">
        {{input-or-static attr=from readonly=delivered}}
      </div>

      <label class="col-lg-1 control-label">Action</label>
      <div class="col-lg-5">
        <p class="form-control-static">
          {{action_name}}
        </p>
      </div>
    </div>

    <div class="form-group" >
      <label class="col-lg-1 control-label">To</label>
      <div class="col-lg-5">
        {{input-or-static attr=to readonly=delivered}}
      </div>

      <label class="col-lg-1 control-label">Template</label>
      <div class="col-lg-5">
        {{#if delivered}}
          <p class="form-control-static">{{email_template.action_name}}</p>
        {{else}}
          {{view Ember.Select
          contentBinding='controllers.email_templates.content'
          optionLabelPath="content.action_name"
          selectionBinding="email_template"
          class="form-control" }}
        {{/if}}
      </div>
    </div>

    <div class="form-group" >
      <label class="col-lg-1 control-label">Cc</label>
      <div class="col-lg-5">
        {{input-or-static attr=cc readonly=delivered}}
      </div>

      <label class="col-lg-1 control-label">Application</label>
      <div class="col-lg-5">
        <p class="form-control-static">
          {{#link-to 'apply_form' apply_form}}
            {{apply_form.name}}
          {{/link-to}}
        </p>
      </div>
    </div>

    <div class="form-group" >
      <label class="col-lg-1 control-label">Bcc</label>
      <div class="col-lg-5">
        {{input-or-static attr=bcc readonly=delivered}}
      </div>

      <label class="col-lg-1 control-label">Project</label>
      <div class="col-lg-5">
        <p class="form-control-static">
          {{#link-to 'workcamp' apply_form.current_workcamp}}
          {{apply_form.current_workcamp.name}}
          {{/link-to}}
        </p>
      </div>
    </div>

    <div class="form-group" >
      <label class="col-lg-1 control-label">Subject</label>
      <div class="col-lg-5">
        {{input-or-static attr=subject readonly=delivered}}
      </div>
      <div class="col-lg-6">
        {{#unless delivered}}
        <ul class="nav nav-pills pull-right" role="tablist">
          <li class="active"><a href="#edit" role="tab" data-toggle="tab">Edit</a></li>
          <li><a href="#preview" role="tab" data-toggle="tab">Preview</a></li>
        </ul>
        {{/unless}}
      </div>
    </div>

    <div class="form-group email-body-area" >
      <div class="col-lg-11 col-lg-offset-1">
        {{#if delivered}}
          <hr/>
          {{{html_body}}}
        {{else}}
          <div class="tab-content">
            <div class="tab-pane active" id="edit">
              {{textarea rows=12 value=body class='form-control' }}
            </div>
            <div class="tab-pane" id="preview">
              <div class='email-preview'>
                {{{html_body}}}
              </div>
            </div>
          </div>
        {{/if}}
      </div>
    </div>
  </fieldset>

  {{#if delivered}}
    <button type="button" class="btn btn-danger pull-right" {{action 'remove'}}>
      Delete
    </button>
  {{else}}
    <button type="button" class="btn btn-danger pull-right" {{action 'remove'}}>
      Discard
    </button>
  <button type="submit" class="btn btn-default">
    Save & Close
  </button>
  <button type="button" class="btn btn-primary" {{action 'send_message' }}>
    {{fa 'send-o'}}
    Send
  </button>
  {{/if}}
</form>
</div>
